function drawBegin(n,t){isDraw=!0;xx=n;yy=t;var i=cs.display.arc({x:n,y:t,radius:line_size/2,start:0,end:360,fill:line_color});cs.addChild(i);add_child(i)}function drawMove(n,t){if(isDraw){var i=cs.display.line({start:{x:xx,y:yy},end:{x:n,y:t},stroke:""+line_size+"px "+line_color,cap:"round"});cs.addChild(i);add_child(i);xx=n;yy=t}else mouseDot.moveTo(n,t),cs.addChild(mouseDot),cs.draw.redraw()}function clearAll(){cs.reset();cs.mouse.hide();mouseDot=cs.display.arc({x:-100,y:-100,radius:Math.max(line_size/2,3),start:0,end:360,fill:line_color,shadow:"0 0 15px #333"});cs.addChild(mouseDot)}function add_child(n){childrens.push(n)}function reDraw(){var n=childrens.pop();n&&(cs.removeChild(n),cs.draw.redraw())}function saveImage(){cs.removeChild(mouseDot);childrens.splice(childrens.indexOf(mouseDot),1);var n=$("#canvasDoodle")[0];ys.downloadImage(n,{filename:"doodle"})}var config_doodle={},canvasDoodle=document.querySelector("#canvasDoodle"),canvasWidth=$(document).width(),canvasHeight=$(document).height(),line_color,line_size,childrens;canvasDoodle.width=Math.round(canvasWidth);canvasDoodle.height=Math.round(canvasHeight);console.log("canvas width:"+canvasDoodle.width+", height:"+canvasDoodle.height);window.pageLoad=function(){config_doodle=ys.loadConfig("form",nameOf(()=>config_doodle))};line_color="#000";line_size=3;$(function(){$(".tool .color div").click(function(){$(".tool .color div").removeClass("active");$(this).addClass("active");line_color=$(this).data("color");mouseDot.fill=line_color});$(".tool .size div").click(function(){$(".tool .size div").removeClass("active");$(this).addClass("active");line_size=$(this).data("size");mouseDot.radius=Math.max(line_size/2,3)})});childrens=[];canvasDoodle.addEventListener("touchmove",function(n){n.preventDefault()},!1);var cs=oCanvas.create({canvas:"#canvasDoodle",background:"#fff",fps:30,disableScrolling:!0}),isDraw=!1,xx=0,yy=0,mouseDot;clearAll();cs.bind("mousedown",function(){drawBegin(cs.mouse.x,cs.mouse.y)}).bind("touchstart tap",function(){drawBegin(cs.touch.x,cs.touch.y)}).bind("mouseup touchend",function(){isDraw=!1}).bind("mousemove",function(){drawMove(cs.mouse.x,cs.mouse.y)}).bind("touchmove",function(){drawMove(cs.touch.x,cs.touch.y)}),function(n,t){var i=t(n),r;typeof define=="function"&&define.amd?define("hotkeys",function(){return i}):(r=n.hotkeys,i.noConflict=function(){var t=n.hotkeys;return n.hotkeys=r,t},n.hotkeys=i)}(this,function(n,t){function d(n){v=n||"all"}function c(){return v||"all"}function y(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,function(){i(window.event)})}function g(n){return typeof n=="string"&&(n=h(n)),f.indexOf(n)!==-1}function nt(){return f.slice(0)}function tt(n){var t=n.keyCode,l,y,o,a,v,h;if(f.indexOf(t)===-1&&f.push(t),(t===93||t===224)&&(t=91),t in r){r[t]=!0;for(a in s)s[a]===t&&(e[a]=!0);return}for(v in r)r[v]=n[b[v]];if(e.filter.call(this,n)&&t in u)for(y=c(),i=0;i<u[t].length;i++)if(o=u[t][i],o.scope===y||o.scope==="all"){l=o.mods.length>0;for(h in r)(!r[h]&&o.mods.indexOf(+h)>-1||r[h]&&o.mods.indexOf(+h)===-1)&&(l=!1);(o.mods.length!==0||r[16]||r[18]||r[17]||r[91])&&!l||o.method(n,o)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0))}}function it(n,i){for(var f,s=w(n),r,l=[],e,o=0;o<s.length;o++){if(r=s[o].split("+"),r.length>1&&(l=p(r)),n=r[r.length-1],n=h(n),i===t&&(i=c()),!u[n])return;for(f=0;f<u[n].length;f++)e=u[n][f],e.scope===i&&rt(e.mods,l)&&(u[n][f]={})}}function rt(n,t){if(n.length!==t.length)return!1;for(var i=0;i<n.length;i++)if(n[i]!==t[i])return!1;return!0}function ut(n){var t=(n.target||n.srcElement).tagName;return!(t==="INPUT"||t==="SELECT"||t==="TEXTAREA")}function p(n){for(var t=n.slice(0,n.length-1),i=0;i<t.length;i++)t[i]=s[t[i]];return t}function w(n){var t;return n=n.replace(/\s/g,""),t=n.split(","),t[t.length-1]===""&&(t[t.length-2]+=","),t}function e(n,i,r){var e=w(n),o=[],f=0;for(r===t&&(r=i,i="all");f<e.length;f++)n=e[f].split("+"),o=[],n.length>1&&(o=p(n),n=[n[n.length-1]]),n=n[0],n=h(n),n in u||(u[n]=[]),u[n].push({shortcut:e[f],scope:i,method:r,key:e[f],mods:o})}var o,a={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},v="all",s={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},f=[],b={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"},r={16:!1,18:!1,17:!1,91:!1},h=function(n){return a[n]||n.toUpperCase().charCodeAt(0)},u={},l;for(k=1;k<20;k++)a["f"+k]=111+k;y(document,"keydown",function(n){tt(n)});y(document,"keyup",function(n){var i=n.keyCode,t=f.indexOf(i);t>=0&&f.splice(t,1)});o={setScope:d,getScope:c,getPressedKeyCodes:nt,isPressed:g,filter:ut,unbind:it};for(l in o)e[l]=o[l];return e});